# v8引擎

> 只有1.4G的内存可以支配，在node中可以使用1.4以上（使用了c++的内存）

v8的内存回收是在内存快要满的时候才会进行内存回收，
两种情况下不会进行内存回收

* 全局变量
* 局部变量没有失去引用的时候

为什么不经常的进行内存回收，因为当内存回收的时候会中断js的执行（回收100M的内存需要10ms）

## 容易引发内存使用不当的情景

* 滥用全局变量
* 缓存不做限制
* 操作大文件

# 内存查看

* 浏览器

  通过window.performance即可获取到性能数据

* node


  通过Node-process.memoryUsage()获取到内存

``` JS
function format(b) {
  return (b / 1024 / 1024).toFixed(2) + 'MB'
}

function getme() {
  let mem = process.memoryUsage()
  console.log('heapTotal: ' + format(mem.heapTotal) + 'heapUsed:' + format(mem.heapUsed))
}
```

# 垃圾回收

![](./img/v8垃圾回收.jpg)

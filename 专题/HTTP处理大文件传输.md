# 处理大文件传输

HTTP 采取了范围请求的解决方案，允许客户端仅仅请求一个资源的一部分。

## 如何支持

1. 服务端支持范围请求（通过添加响应头 Accept-Ranges: none）用来告知客户端这边是支持范围请求的。
2. 客户端指定请求那一部分，通过 Range 这个请求头字段确定

   1.0-499表示从开始到第 499 个字节
   2.500- 表示从第 500 字节到文件终点
   3.-100表示文件的最后100个字节

3. 服务器收到请求后，判断范围是否合法，如果越界了返回 416 否则读取相应的代码片段，返回 206
4. 服务器返回时需要添加 Content-Range 字段，这个字段的格式根据请求头中 Range 字段的不同而有所差异

   1. 单段数据

      1. 响应格式：Accept-Ranges: bytes  Content-Range: bytes 0-9/100

   2. 多段数据

      1. 响应格式：Content-Type: multipart/byteranges; boundary=00000010101
      2. 格式表示请求一定是多段数据请求
      3. 分隔符是  00000010101
      4. 在最后的分隔末尾添上--表示结束。


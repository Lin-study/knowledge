# HTTP 缓存

通过 Cache-Control 验证强缓存是否可用

* 如果可用，直接使用
* 否则进入协商缓存（发送请求，服务器通过请求头中的 If-Modified-Since 或 If-None-Match 这些条件请求字段检查资源是否更新）
  + 如果资源更新，返回资源和200状态码
  + 否则返回304，从缓存中获取

## 代理缓存

假如客户端缓存失效，都要从服务器获取，那么给源服务器的压力很大

### 原理

让代理服务器接管一部分的服务端 HTTP 缓存，客户端缓存过期后，就近到代理缓存中获取，代理缓存过期才会请求源服务器

#### 源服务器缓存控制

在源服务器的响应头中，假如 Cache-Control 这个字段进行缓存控制字段，值为 private（禁止），public（允许）

- must-revalidate 表示客户端缓存过期，需要的源服务器获取
- proxy-revalidate 表示代理服务器缓存过期，需要到源服务器获取
- s-maxage  用于限定缓存在代理服务器中可以存放多久

#### 客户端的缓存控制

- max-stale 表示在代理过期的多少秒内，仍可以从代理中获取
- min-fresh 表示必须在缓存到期前多少秒内获取，否则拿不到
- only-if-cached 仅接受代理服务器缓存，如果代理服务器无效，则直接返回 504